---
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import { initGallery } from "@/scripts/gallery-init.js";
import fs from "fs";
import path from "path";

// èŽ·å–å½“å‰è®¿é—®è·¯å¾„çš„ç›¸å†Œå
const { album } = Astro.params;
const albumPath = `/assets/gallery/${album}`;
const absoluteDir = path.resolve("public" + albumPath);

// åŠ è½½å›¾ç‰‡
// let imageSources = [];
let imageSources: string[] = []; // âœ…

if (fs.existsSync(absoluteDir)) {
  imageSources = fs
    .readdirSync(absoluteDir)
    .filter((file) => /\.(jpg|jpeg|png|webp)$/i.test(file))
    .map((file) => `${albumPath}/${file}`);
}

// ðŸ” å¿…é¡»ï¼šåŠ¨æ€è·¯å¾„åˆ—è¡¨
export async function getStaticPaths() {
  const baseDir = path.resolve("public/assets/gallery");
  const albums = fs.existsSync(baseDir)
    ? fs.readdirSync(baseDir).filter((name) =>
        fs.statSync(path.join(baseDir, name)).isDirectory()
      )
    : [];

  return albums.map((name) => ({
    params: { album: name },
  }));
}
---

<Layout>
  <Header />

  <main class="mx-auto max-w-6xl p-4">
    <h1 class="mb-6 text-3xl font-bold capitalize">ðŸ“¸ ç›¸å†Œï¼š{album}</h1>

    <div id="gallery" class="columns-1 gap-4 sm:columns-2 lg:columns-3">
      {
        imageSources.map((src, index) => (
          <div class="mb-4 break-inside-avoid">
            <a href={src}>
              <img
                src={src}
                alt={`Image ${index}`}
                class="cursor-pointer rounded-lg hover:opacity-80"
                loading="lazy"
              />
            </a>
          </div>
        ))
      }
    </div>
  </main>

  <Footer />

  <!-- LightGallery åˆå§‹åŒ– -->
  <script type="module">
    // import { initGallery } from "/src/scripts/gallery-init.js";
    import { initGallery } from "../../scripts/gallery-init.js";

    initGallery();
  </script>

  <!-- ä¿®æ”¹ LightGallery èƒŒæ™¯é€æ˜Žåº¦ -->
  <style is:global>
    .lg-backdrop {
      background-color: rgba(0, 0, 0, 0.6) !important;
    }
  </style>
</Layout>
